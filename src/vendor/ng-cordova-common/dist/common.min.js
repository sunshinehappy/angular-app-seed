angular.module("common.util",[]),angular.module("common.component",[]),angular.module("common",["common.util","common.component"]),angular.module("common").factory("common.config",function(){var e={auth_expire:86400,version:"Test",release_time:"Test",xinge_access_id:"2100054419",xinge_access_key:"A88UQ5P3F7DM"};if("object"==typeof window.local_config)for(var n in window.local_config)e[n]=window.local_config[n];return e}),angular.module("common.util").factory("common.util.core",function(){var e=/\S+@\S+\.\S+/,n=/^(1[3|4|5|7|8]\d{9})|((\d{3,4}-?)?\d{7,8})$/,t=/^(\d{3,4}-?)?\d{7,8}$/,o=/^1[3|4|5|7|8]\d{9}$/,r={isEmail:function(n){return e.test(n)},isPhone:function(e){return n.test(e)},isTelPhone:function(e){return t.test(e)},isMobilePhone:function(e){return o.test(e)},safeRun:function(){try{var e=Array.prototype.slice.call(arguments,0),n=e.shift();try{return n.apply(window,e)}catch(t){logger.error("safe run failed. func =",n.name,",name=",n.displayName," message=",t.message,t.stack)}}catch(t){logger.error("safe run failed to process arguments. message=",t.message,t.stack)}},safeCall:function(){try{var e=Array.prototype.slice.call(arguments,0),n=e.shift(),t=e.shift();try{return t.apply(n,e)}catch(o){logger.error("safe call failed. message=",o.message,o.stack)}}catch(o){logger.error("safe call failed to process arguments. message=",o.message,o.stack)}},clone:function(e,n){if(null===e||void 0===e||"object"!=typeof e)return e;var t,o=!!n;if(e.constructor===Array){if(o===!1)return e;t=[];for(var i in e)t.push(r.clone(e[i],o));return t}t={};for(var i in e)t[i]=o?r.clone(e[i],!0):e[i];return t}};return r}),angular.module("common.util").factory("common.util.device",[function(){var e,n,t,o=0,r=1,i=2,a=function(){this.uuid="unknown_"+Math.floor(Date.now()*Math.random()),this.platform="";try{this.uuid=window.device.uuid,this.platform=window.device.platform}catch(a){}this.isPhonegap=function(){return"undefined"==typeof e&&(e="undefined"!=typeof cordova||"undefined"!=typeof phonegap),e},this.isCordova=function(){return"undefined"==typeof e&&(e="undefined"!=typeof cordova||"undefined"!=typeof phonegap),e},this.isAndroid=function(){return"undefined"==typeof n&&(n=navigator.userAgent.indexOf("Android")>-1),n},this.isIOS=function(){return"undefined"==typeof t&&(t=/iP(ad|hone|od)/.test(navigator.userAgent)),t},this.getType=function(){return"ios"===this.platform.toLowerCase()?r:"android"===this.platform.toLowerCase()?i:o}};return new a}]),angular.module("common.util").factory("common.util.file",["$q","common.util.device","common.util.logger",function(e,n,t){var o={upload:function(o,r,i){return e(function(e,t){if(!n.isCordova())return t(),!1;var a=new FileUploadOptions,c=o.substr(o.lastIndexOf("/")+1);a.fileKey=i.fileKey?i.fileKey:"file",a.fileName=c?c:"image.jpg",a.mimeType=i.mimeType?i.mimeType:"image/jpeg",a.params=i.params?i.params:{},a.chunkedMode=i.chunkedMode?i.chunkedMode:!0,a.headers=i.headers?i.headers:{};var u=new FileTransfer;u.upload(o,r,function(n){e(n)},function(e){t(e)},a)}).then(function(e){try{navigator.camera.cleanup()}catch(n){t.error(n.message,n.stack)}var o=e.response?JSON.parse(e.response):"";return t.log("Code = "+e.responseCode),t.log("Response = "+e.response),t.log("Sent = "+e.bytesSent),o})}};return o}]),angular.module("common.util").factory("common.util.http",["$http","$q",function(e,n){function t(e){if("object"!=typeof e)return null;var n=[];for(var t in e)n.push(t);n.sort(function(e,n){return e.localeCompare(n)});var o=[];return n.forEach(function(n){o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}),o.join("&")}function o(e){if(!e)return r.options;var n=angular.copy(r.options),t=angular.copy(n.headers);return angular.extend(n,e),e.headers&&(angular.extend(t,e.headers),n.headers=t),"function"!=typeof n.requestIntercept&&(n.requestIntercept=r.defaults.requestIntercept),"function"!=typeof n.responseIntercept&&(n.responseIntercept=r.defaults.responseIntercept),"function"!=typeof n.errorIntercept&&(n.errorIntercept=r.defaults.errorIntercept),n}var r=function(o){return n.when(o).then(o.requestIntercept).then(function(e){return e.local===!0?e.method="GET":e.url=e.origin+e.url,("PUT"==e.method||"POST"==e.method)&&(e.data=t(e.data)),e.headers.HTTP_TIMESTAMP=Date.now(),e}).then(e).then(o.responseIntercept)["catch"](o.errorIntercept)};return r.get=function(e,n){var t=o(n);return t.method="GET",t.url=e,r(t)},r["delete"]=function(e,n){var t=o(n);return t.method="DELETE",t.url=e,r(t)},r.post=function(e,n,t){var i=o(t);return i.method="POST",i.url=e,i.data=n,r(i)},r.put=function(e,n,t){var i=o(t);return i.method="PUT",i.url=e,i.data=n,r(i)},r.defaults={requestIntercept:function(e){return e},responseIntercept:function(e){return e},errorIntercept:function(e){return n.reject(e)}},r.options={timeout:7e3,requestIntercept:r.defaults.requestIntercept,responseIntercept:r.defaults.responseIntercept,errorIntercept:r.defaults.errorIntercept,origin:"",headers:{"Content-Type":"application/x-www-form-urlencoded",HTTP_SIGNATURE:"not_implemented"}},r.config=function(e){r.options=o(e)},r}]),angular.module("common.util").factory("common.util.logger",function(){return window.logger=window.console||{log:function(){},warn:function(){},error:function(){}},window.logger}),angular.module("common.util").factory("common.util.md5",function(){var e=function(e){"use strict";function n(e,n){var t=(65535&e)+(65535&n),o=(e>>16)+(n>>16)+(t>>16);return o<<16|65535&t}function t(e,n){return e<<n|e>>>32-n}function o(e,o,r,i,a,c){return n(t(n(n(o,e),n(i,c)),a),r)}function r(e,n,t,r,i,a,c){return o(n&t|~n&r,e,n,i,a,c)}function i(e,n,t,r,i,a,c){return o(n&r|t&~r,e,n,i,a,c)}function a(e,n,t,r,i,a,c){return o(n^t^r,e,n,i,a,c)}function c(e,n,t,r,i,a,c){return o(t^(n|~r),e,n,i,a,c)}function u(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var o,u,s,f,l,d=1732584193,p=-271733879,m=-1732584194,g=271733878;for(o=0;o<e.length;o+=16)u=d,s=p,f=m,l=g,d=r(d,p,m,g,e[o],7,-680876936),g=r(g,d,p,m,e[o+1],12,-389564586),m=r(m,g,d,p,e[o+2],17,606105819),p=r(p,m,g,d,e[o+3],22,-1044525330),d=r(d,p,m,g,e[o+4],7,-176418897),g=r(g,d,p,m,e[o+5],12,1200080426),m=r(m,g,d,p,e[o+6],17,-1473231341),p=r(p,m,g,d,e[o+7],22,-45705983),d=r(d,p,m,g,e[o+8],7,1770035416),g=r(g,d,p,m,e[o+9],12,-1958414417),m=r(m,g,d,p,e[o+10],17,-42063),p=r(p,m,g,d,e[o+11],22,-1990404162),d=r(d,p,m,g,e[o+12],7,1804603682),g=r(g,d,p,m,e[o+13],12,-40341101),m=r(m,g,d,p,e[o+14],17,-1502002290),p=r(p,m,g,d,e[o+15],22,1236535329),d=i(d,p,m,g,e[o+1],5,-165796510),g=i(g,d,p,m,e[o+6],9,-1069501632),m=i(m,g,d,p,e[o+11],14,643717713),p=i(p,m,g,d,e[o],20,-373897302),d=i(d,p,m,g,e[o+5],5,-701558691),g=i(g,d,p,m,e[o+10],9,38016083),m=i(m,g,d,p,e[o+15],14,-660478335),p=i(p,m,g,d,e[o+4],20,-405537848),d=i(d,p,m,g,e[o+9],5,568446438),g=i(g,d,p,m,e[o+14],9,-1019803690),m=i(m,g,d,p,e[o+3],14,-187363961),p=i(p,m,g,d,e[o+8],20,1163531501),d=i(d,p,m,g,e[o+13],5,-1444681467),g=i(g,d,p,m,e[o+2],9,-51403784),m=i(m,g,d,p,e[o+7],14,1735328473),p=i(p,m,g,d,e[o+12],20,-1926607734),d=a(d,p,m,g,e[o+5],4,-378558),g=a(g,d,p,m,e[o+8],11,-2022574463),m=a(m,g,d,p,e[o+11],16,1839030562),p=a(p,m,g,d,e[o+14],23,-35309556),d=a(d,p,m,g,e[o+1],4,-1530992060),g=a(g,d,p,m,e[o+4],11,1272893353),m=a(m,g,d,p,e[o+7],16,-155497632),p=a(p,m,g,d,e[o+10],23,-1094730640),d=a(d,p,m,g,e[o+13],4,681279174),g=a(g,d,p,m,e[o],11,-358537222),m=a(m,g,d,p,e[o+3],16,-722521979),p=a(p,m,g,d,e[o+6],23,76029189),d=a(d,p,m,g,e[o+9],4,-640364487),g=a(g,d,p,m,e[o+12],11,-421815835),m=a(m,g,d,p,e[o+15],16,530742520),p=a(p,m,g,d,e[o+2],23,-995338651),d=c(d,p,m,g,e[o],6,-198630844),g=c(g,d,p,m,e[o+7],10,1126891415),m=c(m,g,d,p,e[o+14],15,-1416354905),p=c(p,m,g,d,e[o+5],21,-57434055),d=c(d,p,m,g,e[o+12],6,1700485571),g=c(g,d,p,m,e[o+3],10,-1894986606),m=c(m,g,d,p,e[o+10],15,-1051523),p=c(p,m,g,d,e[o+1],21,-2054922799),d=c(d,p,m,g,e[o+8],6,1873313359),g=c(g,d,p,m,e[o+15],10,-30611744),m=c(m,g,d,p,e[o+6],15,-1560198380),p=c(p,m,g,d,e[o+13],21,1309151649),d=c(d,p,m,g,e[o+4],6,-145523070),g=c(g,d,p,m,e[o+11],10,-1120210379),m=c(m,g,d,p,e[o+2],15,718787259),p=c(p,m,g,d,e[o+9],21,-343485551),d=n(d,u),p=n(p,s),m=n(m,f),g=n(g,l);return[d,p,m,g]}function s(e){var n,t="";for(n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function f(e){var n,t=[];for(t[(e.length>>2)-1]=void 0,n=0;n<t.length;n+=1)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function l(e){return s(u(f(e),8*e.length))}function d(e,n){var t,o,r=f(e),i=[],a=[];for(i[15]=a[15]=void 0,r.length>16&&(r=u(r,8*e.length)),t=0;16>t;t+=1)i[t]=909522486^r[t],a[t]=1549556828^r[t];return o=u(i.concat(f(n)),512+8*n.length),s(u(a.concat(o),640))}function p(e){var n,t,o="0123456789abcdef",r="";for(t=0;t<e.length;t+=1)n=e.charCodeAt(t),r+=o.charAt(n>>>4&15)+o.charAt(15&n);return r}function m(e){return unescape(encodeURIComponent(e))}function g(e){return l(m(e))}function h(e){return p(g(e))}function v(e,n){return d(m(e),m(n))}function w(e,n){return p(v(e,n))}function y(e,n,t){return n?t?v(n,e):w(n,e):t?g(e):h(e)}return"function"==typeof define&&define.amd?define(function(){return y}):e.md5=y,y}(this);return e}),angular.module("common.util").factory("common.util.wgs2mars",function(){function e(e,n,t,o){this.west=Math.min(e,t),this.north=Math.max(n,o),this.east=Math.max(e,t),this.south=Math.min(n,o)}function n(e,n,t){return e.west<=n&&e.east>=n&&e.north>=t&&e.south<=t}function t(e,t){for(var o=0;o<s.length;o++)if(n(s[o],e,t)){for(var r=0;r<f.length;r++)if(n(f[r],e,t))return!1;return!0}return!1}function o(e,n){var t=-100+2*e+3*n+.2*n*n+.1*e*n+.2*Math.sqrt(Math.abs(e));return t+=2*(20*Math.sin(6*e*a)+20*Math.sin(2*e*a))/3,t+=2*(20*Math.sin(n*a)+40*Math.sin(n/3*a))/3,t+=2*(160*Math.sin(n/12*a)+320*Math.sin(n*a/30))/3}function r(e,n){var t=300+e+2*n+.1*e*e+.1*e*n+.1*Math.sqrt(Math.abs(e));return t+=2*(20*Math.sin(6*e*a)+20*Math.sin(2*e*a))/3,t+=2*(20*Math.sin(e*a)+40*Math.sin(e/3*a))/3,t+=2*(150*Math.sin(e/12*a)+300*Math.sin(e/30*a))/3}function i(e,n){var i={};if(!t(e,n))return i={lat:n,lng:e};var s=o(e-105,n-35),f=r(e-105,n-35),l=n/180*a,d=Math.sin(l);d=1-u*d*d;var p=Math.sqrt(d);return s=180*s/(c*(1-u)/(d*p)*a),f=180*f/(c/p*Math.cos(l)*a),i={lat:n+s,lng:e+f}}var a=3.141592653589793,c=6378245,u=.006693421622965943,s=[new e(79.4462,49.2204,96.33,42.8899),new e(109.6872,54.1415,135.0002,39.3742),new e(73.1246,42.8899,124.143255,29.5297),new e(82.9684,29.5297,97.0352,26.7186),new e(97.0253,29.5297,124.367395,20.414096),new e(107.975793,20.414096,111.744104,17.871542)],f=[new e(119.921265,25.398623,122.497559,21.785006),new e(101.8652,22.284,106.665,20.0988),new e(106.4525,21.5422,108.051,20.4878),new e(109.0323,55.8175,119.127,50.3257),new e(127.4568,55.8175,137.0227,49.5574),new e(131.2662,44.8922,137.0227,42.5692)];return{transformFromWGSToGCJ:i}}),angular.module("common.component").factory("common.component.eMap",["common.util.wgs2mars","common.util.core","common.util.device","common.util.logger","$q","$http",function(e,n,t,o,r){function i(e){if("undefined"==typeof AMap){window.onloadAMap=function(){n.safeRun(e)};var t="http://webapi.amap.com/maps?v=1.3&key=d7fbf96818d5ca13faa47c9993951f9a&callback=onloadAMap",o=document.createElement("script");o.type="text/javascript",o.src=t,document.querySelector("head").appendChild(o)}else n.safeRun(e)}function a(e,n,t){var o=r.defer();return i(function(){l=new AMap.Map(e,{view:new AMap.View2D({center:new AMap.LngLat(n.lng,n.lat),zoom:t})}),console.log(l),o.resolve(n)}),o.promise}function c(e,o,r){i(function(){var i,a=new AMap.LngLat(e.lng,e.lat);AMap.service(["AMap.Geocoder"],function(){i=new AMap.Geocoder({radius:1e3,extensions:"all"}),i.getAddress(a,function(i,a){if("complete"===i&&"OK"===a.info){var c={message:"表示定位结果",code:161,addr:a.regeocode.formattedAddress,coords:{radius:e.radius,longitude:e.lng,latitude:e.lat}};c.device="undefined"!=typeof t?t:{type:"brower"},n.safeRun(o,c)}else n.safeRun(r,"未找到匹配地址")})})})}function u(){var n=r.defer(),o={};if((!t.isPhonegap()||t.isIOS())&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var o=e.transformFromWGSToGCJ(t.coords.longitude,t.coords.latitude),r={lng:parseFloat(o.lng.toFixed(7)),lat:parseFloat(o.lat.toFixed(7)),radius:parseFloat(t.coords.accuracy.toFixed(2))};n.resolve({code:1,msg:"获取地理定位成功",location:r})},function(e){console.log(e);var t;switch(e.code){case 1:t="您拒绝了系统定位的权限申请";break;case 2:t="无法获取到您所在的地理位置信息";break;case 3:t="获取地理位置信息超时";break;default:t="未知错误"}n.reject({code:0,msg:t,location:o})},m):n.reject({code:0,msg:"无法获取到您所在的地理位置信息",location:o})),t.isAndroid()){var i=function(){};window.plugins.locationService.getCurrentPosition(function(e){e.device="undefined"!=typeof t?t:{type:"brower"};var o={lng:parseFloat(e.coords.longitude.toFixed(7)),lat:parseFloat(e.coords.latitude.toFixed(7)),radius:parseFloat(e.coords.radius.toFixed(2))};n.resolve({code:1,msg:"获取地理定位成功",location:o}),n.reject(e),window.plugins.locationService.stop(i,i)},function(e){n.reject({code:0,msg:e.message,location:o}),window.plugins.locationService.stop(i,i)})}return n.promise}function s(e){var n=r.defer();return i(function(){d=new AMap.Marker({icon:"http://webapi.amap.com/images/marker_sprite.png",position:new AMap.LngLat(e.lng,e.lat)}),d.setMap(l),n.resolve(e)}),n.promise}function f(e,n){var t=r.defer();return i(function(){p=new AMap.Circle({center:new AMap.LngLat(e.lng,e.lat),radius:n,strokeColor:g.strokeColor,strokeOpacity:1,strokeWeight:2,fillColor:g.fillColor,fillOpacity:.35}),p.setMap(l),t.resolve(e,n)}),t.promise}var l,d,p,m={maximumAge:3e3,timeout:1e4,enableHighAccuracy:!0},g={zoom:13,radius:2e3,strokeColor:"rgba(150, 219, 94, 1)",fillColor:"rgba(150, 219, 94, 0.59)"},h={getLocation:function(e,r){try{(!t.isPhonegap()||t.isIOS()||t.isAndroid())&&u().then(function(n){n.code&&c(n.location,e,r)},function(e){n.safeRun(r,e.msg)})}catch(i){o.error(i.message,i.stack),n.safeRun(r,i18n.error.unknown_error)}},addMarker:function(e,o,r){try{(!t.isPhonegap()||t.isIOS()||t.isAndroid())&&u().then(function(t){t.code&&a(e,t.location,g.zoom).then(function(e){s(e).then(function(e){f(e,g.radius).then(function(e){n.safeRun(o,e,g)})})})},function(e){n.safeRun(r,e.msg)})}catch(i){console.log(i.message,i.stack),n.safeRun(r,i18n.error.unknown_error)}},updateCircle:function(e,n){try{if("undefined"==typeof AMap)return;var t={center:new AMap.LngLat(e.lng,e.lat),radius:n,strokeColor:g.strokeColor,strokeOpacity:1,strokeWeight:2,fillColor:g.fillColor,fillOpacity:.35};p.setOptions(t);var o=0;o=n>=0&&1e3>=n?14:n>1e3&&2500>=n?13:n>2500&&5e3>=n?12:n>5e3&&8e3>=n?11:10,l.setZoomAndCenter(o,new AMap.LngLat(e.lng,e.lat))}catch(r){console.log(r.message,r.stack)}}};return h}]),angular.module("common.component").factory("common.component.notification",["common.util.logger","common.util.device",function(e,n){function t(){n.isIOS()?window.plugins.pushNotification.register(c,u,{badge:"true",sound:"true",alert:"true",ecb:"onNotificationAPN"}):n.isAndroid()?(window.plugins.xingePlugin.config(r.xinge_access_id,r.xinge_access_key,i,a),window.plugins.xingePlugin.register(s,f),window.plugins.xingePlugin.getToken(c,u)):e.warn("doesnot support this platform:"+n.platform)}function o(){if(n.isIOS()){var t="nothing";window.plugins.pushNotification.unregister(s,f,t)}else n.isAndroid()?window.plugins.xingePlugin.unregister(s,f):e.warn("doesnot support this platform:"+n.platform)}var r={xinge_access_id:"",xinge_access_key:""},i=function(){e.info("notification config success")},a=function(n){e.error("notification config failed. ",n)},c=function(e){window.push_token=e,console.log("ios token success , data :"+e)},u=function(n){console.log("ios token failed , data :"+n),e.error("notification config failed. ",n)},s=function(){e.info("notification unregister success")},f=function(n){e.error("notification unregister failed. ",n)},l={init:function(i){if(!i)return!1;if(r.xinge_access_id=i.xinge_access_id,r.xinge_access_key=i.xinge_access_key,n.isPhonegap()){try{t()}catch(a){e.error("unhandled error in notification registration: ",a.message,a.stack)}document.addEventListener("wa_logout",function(){try{o()}catch(n){e.error("unhandled error in notification unregistration: ",n.message,n.stack)}}),document.addEventListener("wa_auth_expired",function(){try{o()}catch(n){e.error("unhandled error in notification unregistration: ",n.message,n.stack)}})}},get_token:function(){return window.push_token}};return l}]),angular.module("common.component").factory("common.component.storage",["$q","common.util.logger",function(e,n){var t={prefix:"_eve_",default_expire_mins:30,driver:[localforage.INDEXEDDB,localforage.WEBSQL,localforage.LOCALSTORAGE]},o={},r=function(n,r){var a=e.defer();return localforage.getItem(t.prefix+r,function(e,t){if(e||!t)return a.reject(),!1;var c=t,u=Number(c.expire_at);if(!isNaN(u)&&u>n){var s={expire_at:u,data:c.data};o[r]=s,a.resolve(s.data)}else i.remove(r).then(function(){a.reject()},function(){a.reject()})}),a.promise},i={INDEXEDDB:localforage.INDEXEDDB,WEBSQL:localforage.WEBSQL,LOCALSTORAGE:localforage.LOCALSTORAGE,config:function(e){"object"==typeof e?angular.forEach(e,function(e,n){t[n]=e}):n.error("storage config options not object"),localforage.config({driver:t.driver})},get:function(n){var t=e.defer(),a=Date.now(),c=o[n];return c?(c.expire_at>a?t.resolve(c.data):i.remove(n).then(function(){t.reject()},function(){t.reject()}),t.promise):r(a,n)},set:function(r,i,a){var c=e.defer();if(!i)return n.warn("avoiding putting undefined or null value into storage, key=",r),c.reject(),c.promise;a=Number(a),a=!isNaN(a)&&a>0?a:t.default_expire_mins;var u=Date.now(),s=u+1e3*a*60;return o[r]={expire_at:s,data:i},localforage.setItem(t.prefix+r,{expire_at:s,data:i},function(e){e?c.reject():c.resolve(i)}),c.promise},update:function(n,r){var a=e.defer(),c=Date.now();return localforage.getItem(t.prefix+n,function(e,u){if(e||!u)return a.reject(),!1;var s=u,f=Number(s.expire_at);if(!isNaN(f)&&f>c){var l={expire_at:f,data:r};o[n]=l,localforage.setItem(t.prefix+n,l,function(e){e?a.reject():a.resolve(r)})}else i.remove(n).then(function(){a.reject()},function(){a.reject()})}),a.promise},remove:function(n){var r=e.defer();return o[n]=void 0,localforage.removeItem(t.prefix+n,function(e){e&&r.reject(),r.resolve()}),r.promise},clear:function(){var n=e.defer();return localforage.clear(function(e){e?n.reject():(o={},n.resolve())}),n.promise}};return i}]);